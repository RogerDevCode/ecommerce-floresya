<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêõ DEBUG: Carrusel Simple - FloresYa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>üå∏ DEBUG: Carrusel de FloresYa</h1>
        
        <!-- 1. Carrusel est√°tico que DEBE funcionar -->
        <div class="mb-5">
            <h2>‚úÖ 1. Carrusel Est√°tico (Debe funcionar)</h2>
            <div id="carouselStatic" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="https://dcbavpdlkcjdtjdkntde.supabase.co/storage/v1/object/public/product-images/large/product_2_main_d0bb9dc59de08d1c05aa39f03c1bcf58fb9aeae3aa31d0c5573c59f9e60eb9e7_large.webp" 
                             class="d-block w-100" alt="Imagen 1" style="height: 300px; object-fit: cover;">
                    </div>
                    <div class="carousel-item">
                        <img src="https://dcbavpdlkcjdtjdkntde.supabase.co/storage/v1/object/public/product-images/large/product_8_1_6238e9ccfd62b9ca990e693179e2110f385efb043ed2dcf6a39f74ce18d5d851_large.webp" 
                             class="d-block w-100" alt="Imagen 2" style="height: 300px; object-fit: cover;">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselStatic" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselStatic" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>

        <!-- 2. Carrusel din√°mico -->
        <div class="mb-5">
            <h2>üîß 2. Carrusel Din√°mico (Testeo)</h2>
            <div id="dynamicCarousel">
                <p class="text-muted">Carrusel se cargar√° aqu√≠...</p>
            </div>
            <button class="btn btn-primary mt-2" onclick="loadDynamicCarousel()">Cargar Carrusel desde API</button>
        </div>

        <!-- 3. Logs de debugging -->
        <div class="mb-5">
            <h2>üìã 3. Logs de Debug</h2>
            <div id="debugLogs" class="bg-light p-3 rounded" style="height: 200px; overflow-y: auto;">
                <p class="text-muted">Los logs aparecer√°n aqu√≠...</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Sistema de logging simple
        function log(message, type = 'info') {
            const now = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('debugLogs');
            const color = type === 'error' ? 'text-danger' : type === 'success' ? 'text-success' : 'text-info';
            logDiv.innerHTML += `<div class="${color}"><strong>${now}</strong> - ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${now}] ${message}`);
        }

        // Funci√≥n para cargar carrusel din√°mico
        async function loadDynamicCarousel() {
            log('Iniciando carga de carrusel din√°mico...');
            
            try {
                // 1. Obtener datos del API
                log('Obteniendo datos de /api/carousel...');
                const response = await fetch('/api/carousel');
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error('API devolvi√≥ error: ' + data.message);
                }
                
                const images = data.data.images;
                log(`‚úÖ Recibidas ${images.length} im√°genes del API`, 'success');
                
                // 2. Generar HTML del carrusel
                log('Generando HTML del carrusel...');
                let carouselHTML = `<div id="carouselDynamic" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-inner">`;

                images.forEach((image, index) => {
                    carouselHTML += `
    <div class="carousel-item${index === 0 ? ' active' : ''}">
      <img src="${image.image_url}" class="d-block w-100" alt="${image.alt_text}" style="height: 300px; object-fit: cover;">
      <div class="carousel-caption d-none d-md-block">
        <h5>${image.title}</h5>
      </div>
    </div>`;
                });

                carouselHTML += `
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselDynamic" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselDynamic" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>`;

                // 3. Insertar HTML
                log('Insertando HTML en el contenedor...');
                const container = document.getElementById('dynamicCarousel');
                container.innerHTML = carouselHTML;
                
                log('‚úÖ Carrusel din√°mico creado exitosamente', 'success');
                
                // 4. Verificar que Bootstrap detect√≥ el carrusel
                setTimeout(() => {
                    const carouselElement = document.getElementById('carouselDynamic');
                    if (carouselElement) {
                        log('‚úÖ Elemento del carrusel encontrado en DOM', 'success');
                        
                        // Verificar si Bootstrap inicializ√≥ el carrusel
                        const bsCarousel = bootstrap.Carousel.getInstance(carouselElement);
                        if (bsCarousel) {
                            log('‚úÖ Bootstrap detect√≥ y configur√≥ el carrusel', 'success');
                        } else {
                            log('‚ö†Ô∏è Bootstrap NO detect√≥ el carrusel autom√°ticamente', 'error');
                            // Intentar inicializar manualmente
                            new bootstrap.Carousel(carouselElement);
                            log('üîß Carrusel inicializado manualmente');
                        }
                    }
                }, 500);

            } catch (error) {
                log(`‚ùå ERROR: ${error.message}`, 'error');
            }
        }

        // Al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            log('‚úÖ P√°gina cargada, Bootstrap disponible');
        });
    </script>
</body>
</html>